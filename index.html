<!DOCTYPE html>

<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Todo App</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

```
    body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
        background: #1a1a1a;
        color: #e8e8e8;
        min-height: 100vh;
        padding: 20px;
    }

    .container {
        max-width: 1100px;
        margin: 0 auto;
    }

    header {
        text-align: center;
        margin-bottom: 40px;
        padding: 30px 0;
    }

    h1 {
        font-size: 42px;
        font-weight: 600;
        letter-spacing: -0.5px;
        color: #e8e8e8;
    }

    .controls {
        display: flex;
        gap: 15px;
        margin-bottom: 30px;
        flex-wrap: wrap;
        justify-content: center;
    }

    .btn {
        background: #2d2d2d;
        border: 1px solid #3d3d3d;
        color: #e8e8e8;
        padding: 12px 24px;
        border-radius: 20px;
        cursor: pointer;
        font-size: 14px;
        font-weight: 500;
        transition: all 0.2s ease;
    }

    .btn:hover {
        background: #353535;
        border-color: #4d4d4d;
    }

    .btn:active {
        background: #252525;
        color: #ffffff;
    }

    .btn-primary {
        background: #3d3d3d;
        border: 1px solid #4d4d4d;
        color: #ffffff;
    }

    .btn-primary:hover {
        background: #454545;
        border-color: #5d5d5d;
    }

    .btn-primary:active {
        background: #2d2d2d;
    }

    .filters {
        display: flex;
        gap: 10px;
        margin-bottom: 30px;
        justify-content: center;
        flex-wrap: wrap;
    }

    .filter-btn {
        background: #2d2d2d;
        border: 1px solid #3d3d3d;
        color: #a8a8a8;
        padding: 10px 20px;
        border-radius: 15px;
        cursor: pointer;
        font-size: 13px;
        transition: all 0.2s ease;
    }

    .filter-btn.active {
        background: #3d3d3d;
        color: #ffffff;
        border-color: #4d4d4d;
    }

    .filter-btn:hover {
        background: #353535;
        color: #d8d8d8;
    }

    .filter-btn:active {
        background: #252525;
        color: #ffffff;
    }

    .sort-controls {
        display: flex;
        gap: 10px;
        justify-content: center;
        margin-bottom: 30px;
    }

    .modal {
        display: none;
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.85);
        z-index: 1000;
        align-items: center;
        justify-content: center;
    }

    .modal.active {
        display: flex;
    }

    .modal-content {
        background: #242424;
        padding: 40px;
        border-radius: 25px;
        width: 90%;
        max-width: 500px;
        border: 1px solid #3d3d3d;
        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.7);
    }

    .modal-content h2 {
        margin-bottom: 25px;
        font-size: 24px;
        font-weight: 600;
        color: #e8e8e8;
    }

    .form-group {
        margin-bottom: 20px;
    }

    label {
        display: block;
        margin-bottom: 8px;
        font-size: 13px;
        color: #a8a8a8;
        font-weight: 500;
    }

    input, select, textarea {
        width: 100%;
        padding: 12px 16px;
        background: #2d2d2d;
        border: 1px solid #3d3d3d;
        border-radius: 12px;
        color: #e8e8e8;
        font-size: 14px;
        font-family: inherit;
        transition: all 0.2s ease;
    }

    input:focus, select:focus, textarea:focus {
        outline: none;
        border-color: #5d5d5d;
        background: #323232;
    }

    select option {
        background: #2d2d2d;
        color: #e8e8e8;
    }

    textarea {
        resize: vertical;
        min-height: 80px;
    }

    .time-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 15px;
    }

    .modal-actions {
        display: flex;
        gap: 10px;
        margin-top: 30px;
    }

    .modal-actions .btn {
        flex: 1;
    }

    .tasks-container {
        display: flex;
        flex-direction: column;
        gap: 20px;
    }

    .category-section {
        background: #242424;
        border-radius: 20px;
        padding: 25px;
        border: 1px solid #3d3d3d;
    }

    .category-header {
        font-size: 18px;
        font-weight: 600;
        margin-bottom: 20px;
        color: #e8e8e8;
        display: flex;
        align-items: center;
        gap: 10px;
    }

    .category-icon {
        width: 8px;
        height: 8px;
        border-radius: 50%;
        background: #888888;
    }

    .task-item {
        background: #2d2d2d;
        border-radius: 16px;
        padding: 20px;
        margin-bottom: 12px;
        border: 1px solid #3d3d3d;
        transition: all 0.2s ease;
        cursor: pointer;
    }

    .task-item:hover {
        background: #353535;
        border-color: #4d4d4d;
        transform: translateX(5px);
    }

    .task-item:active {
        background: #252525;
        border-color: #4d4d4d;
    }

    .task-item:active .task-title {
        color: #ffffff;
    }

    .task-item:active .task-description {
        color: #d8d8d8;
    }

    .task-item:active .task-meta {
        color: #c8c8c8;
    }

    .task-item.completed {
        opacity: 0.5;
    }

    .task-item.completed .task-title {
        text-decoration: line-through;
    }

    .task-header {
        display: flex;
        justify-content: space-between;
        align-items: flex-start;
        margin-bottom: 10px;
    }

    .task-title {
        font-size: 16px;
        font-weight: 500;
        color: #e8e8e8;
        margin-bottom: 8px;
    }

    .task-description {
        font-size: 13px;
        color: #a8a8a8;
        margin-bottom: 12px;
        line-height: 1.5;
    }

    .task-meta {
        display: flex;
        flex-wrap: wrap;
        gap: 12px;
        font-size: 12px;
        color: #888888;
    }

    .task-meta-item {
        display: flex;
        align-items: center;
        gap: 5px;
    }

    .task-actions {
        display: flex;
        gap: 8px;
    }

    .task-btn {
        background: #353535;
        border: none;
        color: #e8e8e8;
        padding: 6px 12px;
        border-radius: 8px;
        cursor: pointer;
        font-size: 11px;
        transition: all 0.2s ease;
    }

    .task-btn:hover {
        background: #454545;
    }

    .task-btn:active {
        background: #252525;
        color: #ffffff;
    }

    .deadline-badge {
        display: inline-block;
        padding: 4px 10px;
        border-radius: 8px;
        font-size: 11px;
        font-weight: 500;
        background: #353535;
        color: #e8e8e8;
    }

    .deadline-badge.urgent {
        background: #4a2020;
        color: #ff6b6b;
        border: 1px solid #6a3030;
    }

    .deadline-badge.soon {
        background: #4a3820;
        color: #ffb86b;
        border: 1px solid #6a5030;
    }

    .empty-state {
        text-align: center;
        padding: 60px 20px;
        color: #888888;
    }

    .empty-state-icon {
        font-size: 48px;
        margin-bottom: 15px;
        opacity: 0.5;
    }

    input[type="file"] {
        display: none;
    }

    @media (max-width: 768px) {
        .container {
            padding: 0 10px;
        }

        h1 {
            font-size: 32px;
        }

        .modal-content {
            padding: 30px 20px;
        }

        .time-row {
            grid-template-columns: 1fr;
        }
    }

    /* iPad Landscape Optimization */
    @media (min-width: 769px) and (max-width: 1366px) {
        .container {
            max-width: 95%;
            padding: 0 30px;
        }

        header {
            margin-bottom: 30px;
            padding: 20px 0;
        }

        h1 {
            font-size: 38px;
        }

        .tasks-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 20px;
        }

        .category-section {
            margin-bottom: 0;
        }

        .task-item {
            font-size: 14px;
        }

        .controls {
            margin-bottom: 25px;
        }

        .filters, .sort-controls {
            margin-bottom: 25px;
        }
    }

    /* Wider iPad Landscape */
    @media (min-width: 1024px) and (max-width: 1366px) and (orientation: landscape) {
        .tasks-container {
            grid-template-columns: repeat(3, 1fr);
            gap: 20px;
        }

        .container {
            max-width: 98%;
        }
    }
</style>
```

</head>
<body>
    <div class="container">
        <header>
            <h1>Todo</h1>
        </header>

```
    <div class="controls">
        <button class="btn btn-primary" onclick="openModal()">+ Neue Aufgabe</button>
        <button class="btn" onclick="exportData()">Exportieren</button>
        <button class="btn" onclick="document.getElementById('importFile').click()">Importieren</button>
        <input type="file" id="importFile" accept=".json" onchange="importData(event)">
    </div>

    <div class="filters" id="filters">
        <button class="filter-btn active" data-filter="all" onclick="filterByCategory('all')">Alle</button>
    </div>

    <div class="sort-controls">
        <button class="filter-btn active" onclick="setSortMode('deadline')">Nach Deadline</button>
        <button class="filter-btn" onclick="setSortMode('category')">Nach Kategorie</button>
    </div>

    <div class="tasks-container" id="tasksContainer">
        <div class="empty-state">
            <div class="empty-state-icon">üìã</div>
            <p>Keine Aufgaben vorhanden</p>
            <p style="font-size: 12px; margin-top: 10px;">Erstelle deine erste Aufgabe</p>
        </div>
    </div>
</div>

<!-- Modal -->
<div class="modal" id="taskModal">
    <div class="modal-content">
        <h2 id="modalTitle">Neue Aufgabe</h2>
        <form id="taskForm">
            <div class="form-group">
                <label for="taskTitle">Titel</label>
                <input type="text" id="taskTitle" required>
            </div>

            <div class="form-group">
                <label for="taskDescription">Beschreibung</label>
                <textarea id="taskDescription"></textarea>
            </div>

            <div class="form-group">
                <label for="taskCategory">Kategorie</label>
                <select id="taskCategory" required>
                    <option value="Arbeit">Arbeit</option>
                    <option value="Privat">Privat</option>
                    <option value="Einkaufen">Einkaufen</option>
                    <option value="Termin">Termin</option>
                    <option value="Projekt">Projekt</option>
                </select>
            </div>

            <div class="form-group">
                <label for="taskDeadline">Deadline</label>
                <input type="date" id="taskDeadline" required>
            </div>

            <div class="form-group">
                <label>Zeitraum</label>
                <div class="time-row">
                    <div>
                        <label for="taskStartTime">Startzeit</label>
                        <input type="time" id="taskStartTime">
                    </div>
                    <div>
                        <label for="taskEndTime">Endzeit</label>
                        <input type="time" id="taskEndTime">
                    </div>
                </div>
            </div>

            <div class="modal-actions">
                <button type="button" class="btn" onclick="closeModal()">Abbrechen</button>
                <button type="submit" class="btn btn-primary">Speichern</button>
            </div>
        </form>
    </div>
</div>

<script>
    let tasks = [];
    let currentFilter = 'all';
    let sortMode = 'deadline';
    let editingTaskId = null;

    // Load tasks from localStorage
    function loadTasks() {
        const saved = localStorage.getItem('tasks');
        if (saved) {
            tasks = JSON.parse(saved);
            renderTasks();
        }
    }

    // Save tasks to localStorage
    function saveTasks() {
        localStorage.setItem('tasks', JSON.stringify(tasks));
    }

    // Open modal
    function openModal(taskId = null) {
        const modal = document.getElementById('taskModal');
        const form = document.getElementById('taskForm');
        const title = document.getElementById('modalTitle');

        if (taskId) {
            const task = tasks.find(t => t.id === taskId);
            if (task) {
                title.textContent = 'Aufgabe bearbeiten';
                document.getElementById('taskTitle').value = task.title;
                document.getElementById('taskDescription').value = task.description || '';
                document.getElementById('taskCategory').value = task.category;
                document.getElementById('taskDeadline').value = task.deadline;
                document.getElementById('taskStartTime').value = task.startTime || '';
                document.getElementById('taskEndTime').value = task.endTime || '';
                editingTaskId = taskId;
            }
        } else {
            title.textContent = 'Neue Aufgabe';
            form.reset();
            editingTaskId = null;
        }

        modal.classList.add('active');
    }

    // Close modal
    function closeModal() {
        const modal = document.getElementById('taskModal');
        modal.classList.remove('active');
        document.getElementById('taskForm').reset();
        editingTaskId = null;
    }

    // Handle form submission
    document.getElementById('taskForm').addEventListener('submit', function(e) {
        e.preventDefault();

        const task = {
            id: editingTaskId || Date.now(),
            title: document.getElementById('taskTitle').value,
            description: document.getElementById('taskDescription').value,
            category: document.getElementById('taskCategory').value,
            deadline: document.getElementById('taskDeadline').value,
            startTime: document.getElementById('taskStartTime').value,
            endTime: document.getElementById('taskEndTime').value,
            completed: false,
            createdAt: editingTaskId ? tasks.find(t => t.id === editingTaskId).createdAt : new Date().toISOString()
        };

        if (editingTaskId) {
            const index = tasks.findIndex(t => t.id === editingTaskId);
            tasks[index] = task;
        } else {
            tasks.push(task);
        }

        saveTasks();
        renderTasks();
        updateFilters();
        closeModal();
    });

    // Toggle task completion
    function toggleTask(taskId) {
        const task = tasks.find(t => t.id === taskId);
        if (task) {
            task.completed = !task.completed;
            saveTasks();
            renderTasks();
        }
    }

    // Delete task
    function deleteTask(taskId) {
        if (confirm('M√∂chtest du diese Aufgabe wirklich l√∂schen?')) {
            tasks = tasks.filter(t => t.id !== taskId);
            saveTasks();
            renderTasks();
            updateFilters();
        }
    }

    // Get deadline urgency
    function getDeadlineUrgency(deadline) {
        const today = new Date();
        today.setHours(0, 0, 0, 0);
        const deadlineDate = new Date(deadline);
        const diffTime = deadlineDate - today;
        const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24));

        if (diffDays < 0) return { class: 'urgent', text: '√úberf√§llig' };
        if (diffDays === 0) return { class: 'urgent', text: 'Heute' };
        if (diffDays === 1) return { class: 'soon', text: 'Morgen' };
        if (diffDays <= 3) return { class: 'soon', text: `In ${diffDays} Tagen` };
        return { class: '', text: new Date(deadline).toLocaleDateString('de-DE') };
    }

    // Render tasks
    function renderTasks() {
        const container = document.getElementById('tasksContainer');
        let filteredTasks = currentFilter === 'all' 
            ? tasks 
            : tasks.filter(t => t.category === currentFilter);

        if (filteredTasks.length === 0) {
            container.innerHTML = `
                <div class="empty-state">
                    <div class="empty-state-icon">üìã</div>
                    <p>Keine Aufgaben vorhanden</p>
                    <p style="font-size: 12px; margin-top: 10px;">Erstelle deine erste Aufgabe</p>
                </div>
            `;
            return;
        }

        if (sortMode === 'deadline') {
            // Sort by deadline, then show all together
            filteredTasks.sort((a, b) => {
                if (a.completed !== b.completed) return a.completed ? 1 : -1;
                return new Date(a.deadline) - new Date(b.deadline);
            });

            container.innerHTML = filteredTasks.map(task => createTaskHTML(task)).join('');
        } else {
            // Sort by category, but within each category sort by deadline
            const categories = [...new Set(filteredTasks.map(t => t.category))];
            
            container.innerHTML = categories.map(category => {
                const categoryTasks = filteredTasks
                    .filter(t => t.category === category)
                    .sort((a, b) => {
                        if (a.completed !== b.completed) return a.completed ? 1 : -1;
                        return new Date(a.deadline) - new Date(b.deadline);
                    });

                return `
                    <div class="category-section">
                        <div class="category-header">
                            <span class="category-icon"></span>
                            ${category}
                        </div>
                        ${categoryTasks.map(task => createTaskHTML(task)).join('')}
                    </div>
                `;
            }).join('');
        }
    }

    // Create task HTML
    function createTaskHTML(task) {
        const urgency = getDeadlineUrgency(task.deadline);
        const timeInfo = task.startTime && task.endTime 
            ? `${task.startTime} - ${task.endTime}` 
            : '';

        return `
            <div class="task-item ${task.completed ? 'completed' : ''}" onclick="toggleTask(${task.id})">
                <div class="task-header">
                    <div style="flex: 1;">
                        <div class="task-title">${task.title}</div>
                        ${task.description ? `<div class="task-description">${task.description}</div>` : ''}
                        <div class="task-meta">
                            <div class="task-meta-item">
                                <span class="deadline-badge ${urgency.class}">${urgency.text}</span>
                            </div>
                            ${timeInfo ? `<div class="task-meta-item">üïê ${timeInfo}</div>` : ''}
                            ${sortMode === 'deadline' ? `<div class="task-meta-item">üìÅ ${task.category}</div>` : ''}
                        </div>
                    </div>
                    <div class="task-actions" onclick="event.stopPropagation()">
                        <button class="task-btn" onclick="openModal(${task.id})">‚úèÔ∏è</button>
                        <button class="task-btn" onclick="deleteTask(${task.id})">üóëÔ∏è</button>
                    </div>
                </div>
            </div>
        `;
    }

    // Filter by category
    function filterByCategory(category) {
        currentFilter = category;
        document.querySelectorAll('.filters .filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.dataset.filter === category);
        });
        renderTasks();
    }

    // Set sort mode
    function setSortMode(mode) {
        sortMode = mode;
        document.querySelectorAll('.sort-controls .filter-btn').forEach(btn => {
            btn.classList.toggle('active', btn.textContent.includes(mode === 'deadline' ? 'Deadline' : 'Kategorie'));
        });
        renderTasks();
    }

    // Update filter buttons
    function updateFilters() {
        const categories = [...new Set(tasks.map(t => t.category))];
        const filtersContainer = document.getElementById('filters');
        
        filtersContainer.innerHTML = `
            <button class="filter-btn ${currentFilter === 'all' ? 'active' : ''}" data-filter="all" onclick="filterByCategory('all')">Alle</button>
            ${categories.map(cat => `
                <button class="filter-btn ${currentFilter === cat ? 'active' : ''}" data-filter="${cat}" onclick="filterByCategory('${cat}')">${cat}</button>
            `).join('')}
        `;
    }

    // Export data
    function exportData() {
        const dataStr = JSON.stringify(tasks, null, 2);
        const dataBlob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(dataBlob);
        const link = document.createElement('a');
        link.href = url;
        link.download = `todo-export-${new Date().toISOString().split('T')[0]}.json`;
        link.click();
        URL.revokeObjectURL(url);
    }

    // Import data
    function importData(event) {
        const file = event.target.files[0];
        if (file) {
            const reader = new FileReader();
            reader.onload = function(e) {
                try {
                    const imported = JSON.parse(e.target.result);
                    if (Array.isArray(imported)) {
                        if (confirm('M√∂chtest du die importierten Aufgaben zu den bestehenden hinzuf√ºgen oder diese ersetzen?\n\nOK = Hinzuf√ºgen\nAbbrechen = Ersetzen')) {
                            tasks = [...tasks, ...imported];
                        } else {
                            tasks = imported;
                        }
                        saveTasks();
                        renderTasks();
                        updateFilters();
                        alert('Import erfolgreich!');
                    }
                } catch (error) {
                    alert('Fehler beim Import. Bitte √ºberpr√ºfe die Datei.');
                }
            };
            reader.readAsText(file);
        }
        event.target.value = '';
    }

    // Close modal on outside click
    document.getElementById('taskModal').addEventListener('click', function(e) {
        if (e.target === this) {
            closeModal();
        }
    });

    // Initialize
    loadTasks();
    updateFilters();
</script>
```

</body>
</html>
